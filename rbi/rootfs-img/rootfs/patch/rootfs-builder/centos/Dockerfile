FROM registry.centos.org/centos:7

LABEL maintainer="Ding Ma <ding.ma@linux.alibaba.com>"

RUN yum update -y \
    rpm-4.11.3-45.el7.x86_64 \
    acl-2.2.51-15.el7.x86_64 \
    libblkid-2.23.2-65.el7_9.1.x86_64 \
    libacl-2.2.51-15.el7.x86_64 \
    libdb-utils-5.3.21-25.el7.x86_64 \
    ca-certificates-2020.2.41-70.0.el7_8.noarch \
    nss-softokn-3.53.1-6.el7_9.x86_64 \
    nss-util-3.53.1-1.el7_9.x86_64 \
    2:shadow-utils-4.6-5.el7.x86_64 \
    readline-6.2-11.el7.x86_64 \
    sqlite-3.7.17-8.el7_7.1.x86_64 \
    glibc-common-2.17-324.el7_9.x86_64 \
    centos-release-7-9.2009.1.el7.centos.x86_64 \
    libsmartcols-2.23.2-65.el7_9.1.x86_64 \
    nss-pem-1.0.3-7.el7.x86_64 \
    1:dbus-1.10.24-15.el7.x86_64 \
    binutils-2.27-44.base.el7.x86_64 \
    rpm-libs-4.11.3-45.el7.x86_64 \
    kmod-libs-20-28.el7.x86_64 \
    libcurl-7.29.0-59.el7_9.1.x86_64 \
    1:openssl-libs-1.0.2k-21.el7_9.x86_64 \
    procps-ng-3.3.10-28.el7.x86_64 \
    libcap-2.22-11.el7.x86_64 \
    libxml2-python-2.9.1-6.el7.5.x86_64 \
    python-libs-2.7.5-90.el7.x86_64 \
    libstdc++-4.8.5-44.el7.x86_64 \
    7:device-mapper-1.02.170-6.el7_9.5.x86_64 \
    nss-3.53.1-7.el7_9.x86_64 \
    libgcc-4.8.5-44.el7.x86_64 \
    setup-2.8.71-11.el7.noarch \
    kpartx-0.4.9-134.el7_9.x86_64 \
    chkconfig-1.7.6-1.el7.x86_64 \
    pam-1.1.8-23.el7.x86_64 \
    elfutils-default-yama-scope-0.176-5.el7.noarch \
    python-urlgrabber-3.10-10.el7.noarch \
    dracut-033-572.el7.x86_64 \
    1:dbus-libs-1.10.24-15.el7.x86_64 \
    yum-plugin-fastestmirror-1.1.31-54.el7_8.noarch \
    cryptsetup-libs-2.0.3-6.el7.x86_64 \
    nspr-4.25.0-2.el7_9.x86_64 \
    util-linux-2.23.2-65.el7_9.1.x86_64 \
    yum-plugin-ovl-1.1.31-54.el7_8.noarch \
    nss-softokn-freebl-3.53.1-6.el7_9.x86_64 \
    rpm-python-4.11.3-45.el7.x86_64 \
    libxml2-2.9.1-6.el7.5.x86_64 \
    curl-7.29.0-59.el7_9.1.x86_64 \
    libssh2-1.8.0-4.el7.x86_64 \
    2:vim-minimal-7.4.629-8.el7_9.x86_64 \
    bash-4.2.46-34.el7.x86_64 \
    zlib-1.2.7-19.el7_9.x86_64 \
    rpm-build-libs-4.11.3-45.el7.x86_64 \
    python-2.7.5-90.el7.x86_64 \
    glibc-2.17-324.el7_9.x86_64 \
    libselinux-2.5-15.el7.x86_64 \
    expat-2.1.0-12.el7.x86_64 \
    7:device-mapper-libs-1.02.170-6.el7_9.5.x86_64 \
    passwd-0.79-6.el7.x86_64 \
    audit-libs-2.8.5-4.el7.x86_64 \
    kmod-20-28.el7.x86_64 \
    diffutils-3.3-5.el7.x86_64 \
    openldap-2.4.44-23.el7_9.x86_64 \
    hostname-3.13-3.el7_7.1.x86_64 \
    libdb-5.3.21-25.el7.x86_64 \
    file-libs-5.11-37.el7.x86_64 \
    coreutils-8.22-24.el7_9.2.x86_64 \
    elfutils-libelf-0.176-5.el7.x86_64 \
    python-chardet-2.2.1-3.el7.noarch \
    libuuid-2.23.2-65.el7_9.1.x86_64 \
    nss-tools-3.53.1-7.el7_9.x86_64 \
    lz4-1.8.3-1.el7.x86_64 \
    32:bind-license-9.11.4-26.P2.el7_9.5.noarch \
    libmount-2.23.2-65.el7_9.1.x86_64 \
    krb5-libs-1.15.1-50.el7.x86_64 \
    glib2-2.56.1-9.el7_9.x86_64 \
    systemd-libs-219-78.el7_9.3.x86_64 \
    libcom_err-1.42.9-19.el7.x86_64 \
    systemd-219-78.el7_9.3.x86_64 \
    shared-mime-info-1.8-5.el7.x86_64 \
    nss-sysinit-3.53.1-7.el7_9.x86_64 \
    yum-utils-1.1.31-54.el7_8.noarch \
    sed-4.2.2-7.el7.x86_64 \
    cpio-2.11-28.el7.x86_64 \
    yum-3.4.3-168.el7.centos.noarch \
    libffi-3.0.13-19.el7.x86_64 \
    tzdata-2021a-1.el7.noarch \
    elfutils-libs-0.176-5.el7.x86_64 \
    python-2.7.5-76.el7.x86_64 \
    rpm-python-4.11.3-35.el7.x86_64 \
    libgcc-4.8.5-36.el7.x86_64 \
    acl-2.2.51-14.el7.x86_64 \
    libstdc++-4.8.5-36.el7.x86_64 \
    cryptsetup-libs-2.0.3-3.el7.x86_64 \
    2:vim-minimal-7.4.160-5.el7.x86_64 \
    zlib-1.2.7-18.el7.x86_64 \
    systemd-libs-219-62.el7.x86_64 \
    nss-sysinit-3.36.0-7.el7_5.x86_64 \
    libsmartcols-2.23.2-59.el7.x86_64 \
    krb5-libs-1.15.1-34.el7.x86_64 \
    readline-6.2-10.el7.x86_64 \
    chkconfig-1.7.4-1.el7.x86_64 \
    setup-2.8.71-10.el7.noarch \
    libffi-3.0.13-18.el7.x86_64 \
    rpm-libs-4.11.3-35.el7.x86_64 \
    nss-util-3.36.0-1.el7_5.x86_64 \
    libuuid-2.23.2-59.el7.x86_64 \
    pam-1.1.8-22.el7.x86_64 \
    passwd-0.79-4.el7.x86_64 \
    coreutils-8.22-23.el7.x86_64 \
    rpm-build-libs-4.11.3-35.el7.x86_64 \
    elfutils-libelf-0.172-2.el7.x86_64 \
    libcap-2.22-9.el7.x86_64 \
    lz4-1.7.5-2.el7.x86_64 \
    systemd-219-62.el7.x86_64 \
    nss-tools-3.36.0-7.el7_5.x86_64 \
    elfutils-libs-0.172-2.el7.x86_64 \
    ca-certificates-2018.2.22-70.0.el7_5.noarch \
    yum-utils-1.1.31-50.el7.noarch \
    sqlite-3.7.17-8.el7.x86_64 \
    1:dbus-1.10.24-12.el7.x86_64 \
    shared-mime-info-1.8-4.el7.x86_64 \
    centos-release-7-6.1810.2.el7.centos.x86_64 \
    libcom_err-1.42.9-13.el7.x86_64 \
    yum-3.4.3-161.el7.centos.noarch \
    libselinux-2.5-14.1.el7.x86_64 \
    libblkid-2.23.2-59.el7.x86_64 \
    libdb-utils-5.3.21-24.el7.x86_64 \
    file-libs-5.11-35.el7.x86_64 \
    util-linux-2.23.2-59.el7.x86_64 \
    dracut-033-554.el7.x86_64 \
    cpio-2.11-27.el7.x86_64 \
    openldap-2.4.44-20.el7.x86_64 \
    python-urlgrabber-3.10-9.el7.noarch \
    kmod-libs-20-23.el7.x86_64 \
    glibc-2.17-260.el7.x86_64 \
    glib2-2.56.1-2.el7.x86_64 \
    libxml2-2.9.1-6.el7_2.3.x86_64 \
    rpm-4.11.3-35.el7.x86_64 \
    binutils-2.27-34.base.el7.x86_64 \
    7:device-mapper-1.02.149-10.el7_6.2.x86_64 \
    7:device-mapper-libs-1.02.149-10.el7_6.2.x86_64 \
    libdb-5.3.21-24.el7.x86_64 \
    kmod-20-23.el7.x86_64 \
    elfutils-default-yama-scope-0.172-2.el7.noarch \
    libmount-2.23.2-59.el7.x86_64 \
    libcurl-7.29.0-51.el7.x86_64 \
    bash-4.2.46-31.el7.x86_64 \
    python-libs-2.7.5-76.el7.x86_64 \
    hostname-3.13-3.el7.x86_64 \
    32:bind-license-9.9.4-72.el7.noarch \
    tzdata-2018g-1.el7.noarch \
    nss-softokn-freebl-3.36.0-5.el7_5.x86_64 \
    nspr-4.19.0-1.el7_5.x86_64 \
    nss-softokn-3.36.0-5.el7_5.x86_64 \
    expat-2.1.0-10.el7_3.x86_64 \
    kpartx-0.4.9-123.el7.x86_64 \
    1:dbus-libs-1.10.24-12.el7.x86_64 \
    nss-3.36.0-7.el7_5.x86_64 \
    procps-ng-3.3.10-23.el7.x86_64 \
    1:openssl-libs-1.0.2k-16.el7.x86_64 \
    yum-plugin-ovl-1.1.31-50.el7.noarch \
    2:shadow-utils-4.1.5.1-25.el7.x86_64 \
    audit-libs-2.8.4-4.el7.x86_64 \
    nss-pem-1.0.3-5.el7.x86_64 \
    libssh2-1.4.3-12.el7.x86_64 \
    yum-plugin-fastestmirror-1.1.31-50.el7.noarch \
    glibc-common-2.17-260.el7.x86_64 \
    libxml2-python-2.9.1-6.el7_2.3.x86_64 \
    libacl-2.2.51-14.el7.x86_64 \
    sed-4.2.2-5.el7.x86_64 \
    curl-7.29.0-51.el7.x86_64 \
    python-chardet-2.2.1-1.el7_1.noarch \
    diffutils-3.3-4.el7.x86_64

RUN yum install -y \
    dejavu-sans-fonts-2.33-6.el7.noarch \
    gcc-c++-4.8.5-44.el7.x86_64 \
    fontconfig-2.13.0-4.3.el7.x86_64 \
    libstdc++-static-4.8.5-44.el7.x86_64 \
    libXau-1.0.8-2.1.el7.x86_64 \
    perl-threads-shared-1.43-6.el7.x86_64 \
    libseccomp-devel-2.3.1-4.el7.x86_64 \
    perl-threads-1.87-4.el7.x86_64 \
    perl-Exporter-5.68-3.el7.noarch \
    perl-constant-1.27-2.el7.noarch \
    2:vim-enhanced-7.4.629-8.el7_9.x86_64 \
    glibc-static-2.17-324.el7_9.x86_64 \
    glibc-headers-2.17-324.el7_9.x86_64 \
    automake-1.13.4-3.el7.noarch \
    m4-1.4.16-10.el7.x86_64 \
    perl-File-Temp-0.23.01-3.el7.noarch \
    openssh-7.4p1-21.el7.x86_64 \
    dejavu-fonts-common-2.33-6.el7.noarch \
    git-1.8.3.1-23.el7_8.x86_64 \
    libX11-common-1.6.7-3.el7_9.noarch \
    perl-Socket-2.010-5.el7.x86_64 \
    perl-Thread-Queue-3.02-2.el7.noarch \
    fontpackages-filesystem-1.44-8.el7.noarch \
    perl-Test-Harness-3.28-3.el7.noarch \
    which-2.20-7.el7.x86_64 \
    groff-base-1.22.2-8.el7.x86_64 \
    chrony-3.4-1.el7.x86_64 \
    cpp-4.8.5-44.el7.x86_64 \
    1:perl-Pod-Simple-3.28-4.el7.noarch \
    libseccomp-2.3.1-4.el7.x86_64 \
    perl-Time-Local-1.2300-2.el7.noarch \
    glibc-utils-2.17-324.el7_9.x86_64 \
    libxcb-1.13-1.el7.x86_64 \
    1:make-3.82-24.el7.x86_64 \
    1:perl-Pod-Escapes-1.04-299.el7_9.noarch \
    libstdc++-devel-4.8.5-44.el7.x86_64 \
    perl-Git-1.8.3.1-23.el7_8.noarch \
    libXpm-3.5.12-1.el7.x86_64 \
    libjpeg-turbo-1.2.90-8.el7.x86_64 \
    libX11-1.6.7-3.el7_9.x86_64 \
    perl-Carp-1.26-244.el7.noarch \
    fipscheck-1.4.1-6.el7.x86_64 \
    mpfr-3.1.1-4.el7.x86_64 \
    perl-Data-Dumper-2.145-3.el7.x86_64 \
    1:perl-Error-0.17020-2.el7.noarch \
    openssh-clients-7.4p1-21.el7.x86_64 \
    4:perl-macros-5.16.3-299.el7_9.x86_64 \
    1:perl-parent-0.225-244.el7.noarch \
    2:vim-common-7.4.629-8.el7_9.x86_64 \
    gcc-4.8.5-44.el7.x86_64 \
    perl-Scalar-List-Utils-1.27-248.el7.x86_64 \
    2:libpng-1.5.13-8.el7.x86_64 \
    libmpc-1.0.1-3.el7.x86_64 \
    4:perl-Time-HiRes-1.9725-3.el7.x86_64 \
    gd-2.0.35-27.el7_9.x86_64 \
    perl-Pod-Usage-1.63-3.el7.noarch \
    freetype-2.8-14.el7_9.1.x86_64 \
    perl-Encode-2.51-7.el7.x86_64 \
    perl-Storable-2.45-3.el7.x86_64 \
    perl-Pod-Perldoc-3.20-4.el7.noarch \
    perl-podlators-2.5.1-3.el7.noarch \
    autoconf-2.69-11.el7.noarch \
    4:perl-5.16.3-299.el7_9.x86_64 \
    perl-File-Path-2.09-2.el7.noarch \
    perl-TermReadKey-2.30-20.el7.x86_64 \
    libedit-3.0-12.20121213cvs.el7.x86_64 \
    perl-PathTools-3.40-5.el7.x86_64 \
    rsync-3.1.2-10.el7.x86_64 \
    glibc-devel-2.17-324.el7_9.x86_64 \
    gpm-libs-1.20.7-6.el7.x86_64 \
    perl-Filter-1.49-3.el7.x86_64 \
    perl-Getopt-Long-2.40-3.el7.noarch \
    perl-Text-ParseWords-3.29-4.el7.noarch \
    2:vim-filesystem-7.4.629-8.el7_9.x86_64 \
    4:perl-libs-5.16.3-299.el7_9.x86_64 \
    libgomp-4.8.5-44.el7.x86_64 \
    kernel-headers-3.10.0-1160.31.1.el7.x86_64 \
    less-458-9.el7.x86_64 \
    perl-HTTP-Tiny-0.033-3.el7.noarch
# musl
RUN pushd /root;     curl -sLO https://www.musl-libc.org/releases/musl-1.1.23.tar.gz; tar -zxf musl-1.1.23.tar.gz; 	cd musl-1.1.23; 	sed -i "s/^ARCH = .*/ARCH = x86_64/g" dist/config.mak; 	./configure > /dev/null 2>&1; 	make > /dev/null 2>&1; 	make install > /dev/null 2>&1; 	echo "/usr/local/musl/lib" > /etc/ld-musl-x86_64.path; 	popd
ENV PATH=$PATH:/usr/local/musl/bin

# go
RUN cd /tmp ; curl -OL https://storage.googleapis.com/golang/go1.14.4.linux-amd64.tar.gz
RUN tar -C /usr/ -xzf /tmp/go1.14.4.linux-amd64.tar.gz
ENV GOROOT=/usr/go
ENV PATH=$PATH:$GOROOT/bin:$GOPATH/bin

# rust
RUN curl --proto '=https' --tlsv1.2 https://sh.rustup.rs -sSLf --output /tmp/rust-init;     chmod a+x /tmp/rust-init; 	export http_proxy=; 	export https_proxy=; 	/tmp/rust-init -y --default-toolchain 1.47.0
RUN . /root/.cargo/env;     export http_proxy=; 	export https_proxy=; 	cargo install cargo-when; 	rustup target install x86_64-unknown-linux-musl
RUN ln -sf /usr/bin/g++ /bin/musl-g++